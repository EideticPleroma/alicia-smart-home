version: '3.8'

services:
  # MQTT Broker
  mqtt-broker:
    image: eclipse-mosquitto:2.0.18
    container_name: alicia-mqtt-broker
    ports:
      - "1883:1883"
      - "8883:8883"
    volumes:
      - ./config/mqtt/mosquitto-simple.conf:/mosquitto/config/mosquitto.conf
      - ./config/mqtt/passwords:/mosquitto/config/passwords
      - ./config/mqtt/acl:/mosquitto/config/acl
    networks:
      - alicia_network

  # Alicia Config Manager
  alicia-config-manager:
    build: ./services/alicia-config-manager
    container_name: alicia-config-manager
    ports:
      - "3000:3000"
      - "3001:3001"
    environment:
      - MQTT_BROKER_URL=mqtts://mqtt-broker:8883
    depends_on:
      - mqtt-broker
    networks:
      - alicia_network

  # Alicia Monitor
  alicia-monitor:
    build: ./services/alicia-monitor
    container_name: alicia-monitor
    ports:
      - "3002:3002"
    environment:
      - MQTT_BROKER_URL=mqtts://mqtt-broker:8883
    depends_on:
      - mqtt-broker
    networks:
      - alicia_network

  # MCP QA Orchestrator
  mcp-qa-orchestrator:
    build: ./services/mcp-qa-orchestrator
    container_name: mcp-qa-orchestrator
    ports:
      - "8080:8080"
      - "8081:8081"
    environment:
      - MQTT_BROKER_URL=mqtts://mqtt-broker:8883
      - GROK_API_KEY=free_with_cline
    depends_on:
      - mqtt-broker
    networks:
      - alicia_network

networks:
  alicia_network:
    driver: bridge
